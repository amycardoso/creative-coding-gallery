---
import BaseLayout from "../layouts/BaseLayout.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import { fetchSketches } from "../data/fetch-sketches";
import type { Sketch } from "../data/fetch-sketches";

export async function getStaticPaths() {
  const sketches = await fetchSketches();
  return sketches.map((sketch) => ({
    params: { slug: sketch.slug },
    props: { sketch },
  }));
}

interface Props {
  sketch: Sketch;
}

const { sketch } = Astro.props;
const base = import.meta.env.BASE_URL;
---

<BaseLayout
  title={`${sketch.title} â€” Creative Coding Gallery`}
  description={sketch.description}
  ogImage={sketch.mediaUrl}
>
  <Header />
  <main class="container">
    <article class="detail">
      <a href={base} class="back-link">&larr; Back to gallery</a>

      <div class="detail-media">
        <img
          src={sketch.mediaUrl}
          alt={sketch.title}
          loading="eager"
          decoding="async"
        />
      </div>

      <h1 class="detail-title">{sketch.title}</h1>
      <p class="detail-description">{sketch.description}</p>

      <dl class="detail-meta">
        <div>
          <dt>Date</dt>
          <dd>{new Date(sketch.date).toLocaleDateString("en-US", { year: "numeric", month: "long", day: "numeric" })}</dd>
        </div>
        <div>
          <dt>Tech Stack</dt>
          <dd class="tags">
            {sketch.tech.map((t) => <span class="tag">{t}</span>)}
          </dd>
        </div>
        <div>
          <dt>Tags</dt>
          <dd class="tags">
            {sketch.tags.map((tag) => <span class="tag">{tag}</span>)}
          </dd>
        </div>
        <div>
          <dt>Source</dt>
          <dd><a href={sketch.sourceUrl} rel="noopener noreferrer">View on GitHub</a></dd>
        </div>
      </dl>
    </article>
  </main>
  <Footer />
</BaseLayout>

<style>
  .detail {
    padding: var(--space-3xl) 0;
  }
</style>
